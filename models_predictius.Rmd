---
title: 'StatWars: models predictius'
author: "Arnau Garcia"
date: "2024-10-14"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# StatWars: els meus primers models predictius

En aquesta activitat, us volem presentar una eina molt poderosa que utilitzem en estadística per entendre millor el món que ens envolta: els **models predictius**. Aquests models ens ajuden a predir què passarà en el futur a partir de dades que ja coneixem. A través de conceptes senzills com les **regressions lineals** i les **regressions lineals generalitzades**, veurem com podem utilitzar les matemàtiques per establir relacions entre diferents variables i fer prediccions amb aquestes. Descobrireu com la combinació d'estadística i matemàtiques ens pot ajudar a prendre decisions basades en dades, d'una manera més informada i precisa.

Aquest document serveix com a exemple de com ajustar dos models predictius fent servir el llenguatge de programació **R**. **R**, <https://es.wikipedia.org/wiki/R\_(lenguaje_de_programaci%C3%B3n)>, és el principal llenguatge de programació pels estadístics. Es tracta d'un software lliure, gratuït que es troba a l'abast de tothom.

Veurem dos models predictius:

- Predicció de preus d'immobles. 
- Predicció d'espècies de pingüins.

## Predicció de preus d'inmobles

Farem servir la següent taula de dades:


```{r, eval=FALSE}
lm <- lm(Price ~ ., data = cases_train[,2:10])
summary(lm)
```

```{r}
library(openintro)
data(ames)
library(ggplot2)
ggplot(data = ames) +
  geom_point(aes(x = area, y = price))
ggplot(data = ames) +
  geom_point(aes(x = Overall.Qual, y = price))
ggplot(data = ames) +
  geom_point(aes(x = Overall.Cond, y = price))
ggplot(data = ames) +
  geom_point(aes(x = Year.Built, y = price))
ggplot(data = ames) +
  geom_boxplot(aes(x = Street, y = price))
ggplot(data = ames) +
  geom_boxplot(aes(x = Bldg.Type, y = price))
ggplot(data = ames) +
  geom_boxplot(aes(x = Kitchen.Qual, y = price))
ggplot(data = ames) +
  geom_point(aes(x = Garage.Cars, y = price))
ggplot(data = ames) +
  geom_point(aes(x = Garage.Area, y = price))
ggplot(data = ames) +
  geom_boxplot(aes(x = Central.Air, y = price))
```

Ames data set <https://www.openintro.org/data/index.php?data=ames> seems to be better to build a prediction model.

We select some variables to work only with these variables:

```{r}
cases <- ames[, c("price", "area", "Overall.Qual", "Overall.Cond", "Year.Built",
                  "Street", "Bldg.Type", "Garage.Cars", "Garage.Area", 
                  "Central.Air")]
head(cases)
```

```{r}
set.seed(1234)
n <- nrow(cases)
train_prop <- 99/100
train_ind <- sample(1:n, train_prop * n)
cases_train <- cases[train_ind, ]
cases_test <- cases[-train_ind, ]
```


Quick check for the linear model:

```{r}
lm <- lm(price ~ ., data = cases_train)
summary(lm)
modAIC <- step(lm)
summary(modAIC)
```

```{r}
preds <- predict(modAIC, newdata = cases_test)
comparison <- data.frame(real = cases_test$price, predicted = preds,
                         difer = abs(cases_test$price - preds),
                         diffs = cases_test$price - preds)
comparison
```

```{r}
sum(comparison$diffs)
```


Trying another data set:

```{r}
insurance <- read.csv("insurance.csv")
```

Let us do some data exploration:

```{r}
ggplot(insurance)+
  geom_point(aes(x=age, y=charges))
ggplot(insurance)+
  geom_boxplot(aes(x=sex, y=charges))
ggplot(insurance)+
  geom_boxplot(aes(x=as.factor(children), y=charges))
ggplot(insurance)+
  geom_point(aes(x=(bmi), y=charges))
ggplot(insurance)+
  geom_boxplot(aes(x=smoker, y=charges))
ggplot(insurance)+
  geom_boxplot(aes(x=region, y=charges))
```


Let us split data an fit lm using stepwise:

```{r}
set.seed(1234)
n <- nrow(insurance)
train_prop <- 9/10
train_ind <- sample(1:n, train_prop * n)
insurance_train <- insurance[train_ind, ]
insurance_test <- insurance[-train_ind, ]
```

The lm:

```{r}
linmod <- lm(charges ~ ., data = insurance)
summary(linmod)
mod_aic <- step(linmod)
summary(mod_aic)
```

Now let us make predictions:

```{r}
preds2 <- predict(mod_aic, newdata = insurance_test)
comparison2 <- data.frame(real = insurance_test$charges, predicted = preds2,
                         difer = abs(insurance_test$charges - preds2))
comparison2
```

